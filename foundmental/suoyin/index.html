<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MySQL WIKI"><meta name=author content=fengzhao><link href=https://mysql.fengzhao.me/foundmental/suoyin/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.6"><title>索引相关 - MySQL WIKI</title><link rel=stylesheet href=../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="MySQL WIKI" class="md-header__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MySQL WIKI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 索引相关 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/fengzhao/mysql-wiki/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../resources/ class=md-tabs__link> MySQL相关资源 </a> </li> <li class=md-tabs__item> <a href=../../basic/0.mysql_source/ class=md-tabs__link> MySQL 入门 </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> MySQL 基础 </a> </li> <li class=md-tabs__item> <a href=../../advanced/1.0.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0innoDB%E6%9E%B6%E6%9E%84/ class=md-tabs__link> MySQL 高级 </a> </li> <li class=md-tabs__item> <a href=../../ui/index.md class=md-tabs__link> Ansible UI </a> </li> <li class=md-tabs__item> <a href=../../certification/index.md class=md-tabs__link> Ansible 认证 </a> </li> <li class=md-tabs__item> <a href=../../roles/index.md class=md-tabs__link> Ansible Roles </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="MySQL WIKI" class="md-nav__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> MySQL WIKI </label> <div class=md-nav__source> <a href=https://github.com/fengzhao/mysql-wiki/ title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../resources/ class=md-nav__link> MySQL相关资源 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> MySQL 入门 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MySQL 入门" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> MySQL 入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/0.mysql_source/ class=md-nav__link> 0. MySQL的起源和分支 </a> </li> <li class=md-nav__item> <a href=../../basic/1.introduce_database/ class=md-nav__link> 1. 数据库概述 </a> </li> <li class=md-nav__item> <a href=../../basic/2.install_mysql/ class=md-nav__link> 2. 安装 MySQL </a> </li> <li class=md-nav__item> <a href=../../basic/3.mysql_execute_command/ class=md-nav__link> 3. MySQL可执行程序 </a> </li> <li class=md-nav__item> <a href=../../basic/4.sql/ class=md-nav__link> 4. SQL语句和语法 </a> </li> <li class=md-nav__item> <a href=../../basic/5.relation/ class=md-nav__link> 5. 关系模型和关系代数 </a> </li> <li class=md-nav__item> <a href=../../basic/6.sql_practice/ class=md-nav__link> 6. SQL题目练习 </a> </li> <li class=md-nav__item> <a href=../../basic/Ansible-command.md class=md-nav__link> 7. 熟悉 ansible 命令 </a> </li> <li class=md-nav__item> <a href=../../basic/8.MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99/ class=md-nav__link> 8. MySQL字符集和排序规则 </a> </li> <li class=md-nav__item> <a href=../../basic/9.mysql_architecture/ class=md-nav__link> 9. MySQL逻辑架构和性能优化概述 </a> </li> <li class=md-nav__item> <a href=../../basic/Variables.md class=md-nav__link> 10. 使用变量 </a> </li> <li class=md-nav__item> <a href=../../basic/Facts.md class=md-nav__link> 11. Facts 数据 </a> </li> <li class=md-nav__item> <a href=../../basic/Jinja2.md class=md-nav__link> 12. Jinja2 模板语法 </a> </li> <li class=md-nav__item> <a href=../../basic/Conditionals-loop.md class=md-nav__link> 13. 条件判断与循环 </a> </li> <li class=md-nav__item> <a href=../../basic/Blocks.md class=md-nav__link> 14. Blocks </a> </li> <li class=md-nav__item> <a href=../../basic/Playbook-features.md class=md-nav__link> 15. Playbook 高级特性 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_17 type=checkbox id=__nav_3_17> <label class=md-nav__link for=__nav_3_17> 扩展阅读(深入必读) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=扩展阅读(深入必读) data-md-level=2> <label class=md-nav__title for=__nav_3_17> <span class="md-nav__icon md-icon"></span> 扩展阅读(深入必读) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/Reference/Yaml.md class=md-nav__link> 1. YAML 语法 </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Vaults.md class=md-nav__link> 2. Vaults 加密数据 </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Keywords.md class=md-nav__link> 3. 关键字使用 </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Module.md class=md-nav__link> 4. 模块索引 </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Config.md class=md-nav__link> 5. Ansible 配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_18 type=checkbox id=__nav_3_18> <label class=md-nav__link for=__nav_3_18> Windows <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Windows data-md-level=2> <label class=md-nav__title for=__nav_3_18> <span class="md-nav__icon md-icon"></span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/Windows/manager-windows.md class=md-nav__link> 1. 管理 Windows 主机 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> MySQL 基础 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MySQL 基础" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> MySQL 基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> 索引相关 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-config.md class=md-nav__link> Ansible 的常用设置 </a> </li> <li class=md-nav__item> <a href=../../advanced/best-practices.md class=md-nav__link> Ansible 最佳实践 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-lint.md class=md-nav__link> 使用 Ansible-lint </a> </li> <li class=md-nav__item> <a href=../../advanced/dynamic-hosts.md class=md-nav__link> 使用动态主机 </a> </li> <li class=md-nav__item> <a href=../../advanced/dynamic-inventory.md class=md-nav__link> 使用动态主机管理云服务 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7 type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7> Ansible 安全 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 安全" data-md-level=2> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Ansible 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/security/index.md class=md-nav__link> Ansible 控制节点安全 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/firewall.md class=md-nav__link> - 节点安全: 防火墙设置 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/ssh-2step.md class=md-nav__link> - 节点安全: ssh登录二次验证 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/audit.md class=md-nav__link> - 节点安全: 命令审计 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/vault-hosts.md class=md-nav__link> - 节点安全: 加密主机清单 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/filter-command.md class=md-nav__link> 过滤 Ansible 危险指令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_8 type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8> Ansible 实践 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 实践" data-md-level=2> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Ansible 实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/practice/snippets.md class=md-nav__link> Ansible Task片段 </a> </li> <li class=md-nav__item> <a href=../../advanced/practice/jenkins-and-ansible.md class=md-nav__link> 在 Jenkins 中使用 Ansible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../advanced/ara.md class=md-nav__link> 使用 ARA 记录 Ansible 执行结果 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-cmdb.md class=md-nav__link> 使用 Ansible-cmdb </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> MySQL 高级 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MySQL 高级" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MySQL 高级 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_1 type=checkbox id=__nav_5_1> <label class=md-nav__link for=__nav_5_1> 深入理解innoDB存储引擎 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=深入理解innoDB存储引擎 data-md-level=2> <label class=md-nav__title for=__nav_5_1> <span class="md-nav__icon md-icon"></span> 深入理解innoDB存储引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/1.0.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0innoDB%E6%9E%B6%E6%9E%84/ class=md-nav__link> 1.0.MySQL架构到innoDB架构 </a> </li> <li class=md-nav__item> <a href=../../advanced/1.1.0.InnoDB%E2%80%94%E2%80%94%E7%AE%80%E4%BB%8B/ class=md-nav__link> 1.1.0.InnoDB——简介 </a> </li> <li class=md-nav__item> <a href=../../advanced/1.1.1.InnoDB%E2%80%94%E2%80%94%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7/ class=md-nav__link> 1.1.1.InnoDB——关键特性 </a> </li> <li class=md-nav__item> <a href=../../advanced/1.2.0.InnoDB%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E7%BC%93%E5%86%B2%E6%B1%A0/ class=md-nav__link> 1.2.0.InnoDB内存结构——缓冲池 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../dev/ansible-architecture.md class=md-nav__link> Ansible 架构 </a> </li> <li class=md-nav__item> <a href=../../dev/pycharm-remote-development.md class=md-nav__link> 使用 PyCharm 远程开发 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_4 type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4> Ansible 调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 调试" data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Ansible 调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/debug/verbose-debug.md class=md-nav__link> 详细输出 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/pdb.md class=md-nav__link> pdb 本地调试 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/pycharm.md class=md-nav__link> PyCharm 远程调试 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/module-debug.md class=md-nav__link> 模块调试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_5 type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5> Module 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Module 开发" data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Module 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/modules/index.md class=md-nav__link> Module 开发说明 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/remote_copy.md class=md-nav__link> 创建一个简单的module </a> </li> <li class=md-nav__item> <a href=../../dev/modules/huawei-switch.md class=md-nav__link> module 示例: 连接华为交换机 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-outher-dev.md class=md-nav__link> module 示例: 其他语言开发 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-shell-dir.md class=md-nav__link> module 示例: dir </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-docker-facts.md class=md-nav__link> module 示例: docker_facts </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-wechat.md class=md-nav__link> module 示例: wechat </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-return.md class=md-nav__link> module 的返回值 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-doc.md class=md-nav__link> module 的帮助文档 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-architecture.md class=md-nav__link> module 架构 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-utilities.md class=md-nav__link> module 工具类 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_6 type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6> Plugin 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Plugin 开发" data-md-level=2> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Plugin 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/plugins/index.md class=md-nav__link> Plugin 开发说明 </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Action-hello.md class=md-nav__link> Action 示例: hello </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Callback-BlackHole.md class=md-nav__link> Callback 示例: BlackHole </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Filter-split.md class=md-nav__link> Filter 示例: split </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Inventory-csv.md class=md-nav__link> Inventory 示例: csv </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Lookup-github-status.md class=md-nav__link> Lookup 示例: github_status </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Vars-csv-vars.md class=md-nav__link> Vars 示例: csv_vars </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5_7 type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7> API 使用 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API 使用" data-md-level=2> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> API 使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/api/index.md class=md-nav__link> API 使用说明 </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-task.md class=md-nav__link> 使用 API 运行任务 </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-playbook.md class=md-nav__link> 使用 API 运行 Palybook </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-suitable.md class=md-nav__link> 使用 suitable </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-ansible-runner.md class=md-nav__link> 使用 ansible runner </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Ansible UI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible UI" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Ansible UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ui/index.md class=md-nav__link> Ansible UI 说明 </a> </li> <li class=md-nav__item> <a href=../../ui/awx.md class=md-nav__link> Ansible Awx </a> </li> <li class=md-nav__item> <a href=../../ui/tower.md class=md-nav__link> Ansible Tower </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Ansible 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 认证" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Ansible 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../certification/index.md class=md-nav__link> Ansible 认证说明 </a> </li> <li class=md-nav__item> <a href=../../certification/ex407-example.md class=md-nav__link> EX407 示例试题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Ansible Roles <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible Roles" data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Ansible Roles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/index.md class=md-nav__link> Ansible roles 怎么用？ </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_2 type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2> 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=认证 data-md-level=2> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/auth/kerberos-client.md class=md-nav__link> kerberos-client </a> </li> <li class=md-nav__item> <a href=../../roles/auth/kerberos-server.md class=md-nav__link> kerberos-server </a> </li> <li class=md-nav__item> <a href=../../roles/auth/openldap.md class=md-nav__link> openldap </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_3 type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3> 系统环境 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=系统环境 data-md-level=2> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> 系统环境 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/env/ant.md class=md-nav__link> ant </a> </li> <li class=md-nav__item> <a href=../../roles/env/erlang.md class=md-nav__link> erlang </a> </li> <li class=md-nav__item> <a href=../../roles/env/go.md class=md-nav__link> go </a> </li> <li class=md-nav__item> <a href=../../roles/env/hostnames.md class=md-nav__link> hostnames </a> </li> <li class=md-nav__item> <a href=../../roles/env/java.md class=md-nav__link> java </a> </li> <li class=md-nav__item> <a href=../../roles/env/lua.md class=md-nav__link> lua </a> </li> <li class=md-nav__item> <a href=../../roles/env/mvn.md class=md-nav__link> mvn </a> </li> <li class=md-nav__item> <a href=../../roles/env/nodejs.md class=md-nav__link> nodejs </a> </li> <li class=md-nav__item> <a href=../../roles/env/openssh.md class=md-nav__link> openssh </a> </li> <li class=md-nav__item> <a href=../../roles/env/openssl.md class=md-nav__link> openssl </a> </li> <li class=md-nav__item> <a href=../../roles/env/os-init.md class=md-nav__link> os-init </a> </li> <li class=md-nav__item> <a href=../../roles/env/php.md class=md-nav__link> php </a> </li> <li class=md-nav__item> <a href=../../roles/env/python2.7.md class=md-nav__link> python2.7 </a> </li> <li class=md-nav__item> <a href=../../roles/env/repo-epel.md class=md-nav__link> repo-epel </a> </li> <li class=md-nav__item> <a href=../../roles/env/ruby.md class=md-nav__link> ruby </a> </li> <li class=md-nav__item> <a href=../../roles/env/sbt.md class=md-nav__link> sbt </a> </li> <li class=md-nav__item> <a href=../../roles/env/ssh-2fa.md class=md-nav__link> ssh-2fa </a> </li> <li class=md-nav__item> <a href=../../roles/env/ssh-keys.md class=md-nav__link> ssh-keys </a> </li> <li class=md-nav__item> <a href=../../roles/env/update-kernel.md class=md-nav__link> update-kernel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_4 type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4> WEB <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=WEB data-md-level=2> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> WEB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/web/nginx.md class=md-nav__link> nginx </a> </li> <li class=md-nav__item> <a href=../../roles/web/openresty.md class=md-nav__link> openresty </a> </li> <li class=md-nav__item> <a href=../../roles/web/tengine.md class=md-nav__link> tengine </a> </li> <li class=md-nav__item> <a href=../../roles/web/tomcat.md class=md-nav__link> tomcat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_5 type=checkbox id=__nav_8_5> <label class=md-nav__link for=__nav_8_5> 数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据库 data-md-level=2> <label class=md-nav__title for=__nav_8_5> <span class="md-nav__icon md-icon"></span> 数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/database/memcached.md class=md-nav__link> memcached </a> </li> <li class=md-nav__item> <a href=../../roles/database/mongodb.md class=md-nav__link> mongodb </a> </li> <li class=md-nav__item> <a href=../../roles/database/mycat.md class=md-nav__link> mycat </a> </li> <li class=md-nav__item> <a href=../../roles/database/mysql.md class=md-nav__link> mysql </a> </li> <li class=md-nav__item> <a href=../../roles/database/mysql57.md class=md-nav__link> mysql57 </a> </li> <li class=md-nav__item> <a href=../../roles/database/redis.md class=md-nav__link> redis </a> </li> <li class=md-nav__item> <a href=../../roles/database/redis5.md class=md-nav__link> redis5 </a> </li> <li class=md-nav__item> <a href=../../roles/database/codis.md class=md-nav__link> codis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_6 type=checkbox id=__nav_8_6> <label class=md-nav__link for=__nav_8_6> 键值存储 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=键值存储 data-md-level=2> <label class=md-nav__title for=__nav_8_6> <span class="md-nav__icon md-icon"></span> 键值存储 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/kv/consul.md class=md-nav__link> consul </a> </li> <li class=md-nav__item> <a href=../../roles/kv/etcd.md class=md-nav__link> etcd </a> </li> <li class=md-nav__item> <a href=../../roles/kv/zookeeper.md class=md-nav__link> zookeeper </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_7 type=checkbox id=__nav_8_7> <label class=md-nav__link for=__nav_8_7> 大数据 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=大数据 data-md-level=2> <label class=md-nav__title for=__nav_8_7> <span class="md-nav__icon md-icon"></span> 大数据 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/bigdata/airflow.md class=md-nav__link> airflow </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-agent.md class=md-nav__link> cdh5-agent </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-pre.md class=md-nav__link> cdh5-pre </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-server.md class=md-nav__link> cdh5-server </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/hadoop-standalone.md class=md-nav__link> hadoop-standalone </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/superset.md class=md-nav__link> superset </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_8 type=checkbox id=__nav_8_8> <label class=md-nav__link for=__nav_8_8> 消息系统 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=消息系统 data-md-level=2> <label class=md-nav__title for=__nav_8_8> <span class="md-nav__icon md-icon"></span> 消息系统 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/mq/kafka.md class=md-nav__link> kafka </a> </li> <li class=md-nav__item> <a href=../../roles/mq/kafka-manager.md class=md-nav__link> kafka-manager </a> </li> <li class=md-nav__item> <a href=../../roles/mq/rabbitmq.md class=md-nav__link> rabbitmq </a> </li> <li class=md-nav__item> <a href=../../roles/mq/rocketmq.md class=md-nav__link> rocketmq </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_9 type=checkbox id=__nav_8_9> <label class=md-nav__link for=__nav_8_9> 持续集成/交付 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=持续集成/交付 data-md-level=2> <label class=md-nav__title for=__nav_8_9> <span class="md-nav__icon md-icon"></span> 持续集成/交付 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ci/deploy-image.md class=md-nav__link> deploy-image </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-static.md class=md-nav__link> deploy-static </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-supervisor.md class=md-nav__link> deploy-supervisor </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-tomcat.md class=md-nav__link> deploy-tomcat </a> </li> <li class=md-nav__item> <a href=../../roles/ci/jenkins.md class=md-nav__link> jenkins </a> </li> <li class=md-nav__item> <a href=../../roles/ci/nexus.md class=md-nav__link> nexus </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_10 type=checkbox id=__nav_8_10> <label class=md-nav__link for=__nav_8_10> 高可用 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=高可用 data-md-level=2> <label class=md-nav__title for=__nav_8_10> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ha/keepalived.md class=md-nav__link> keepalived </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_11 type=checkbox id=__nav_8_11> <label class=md-nav__link for=__nav_8_11> 代理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=代理 data-md-level=2> <label class=md-nav__title for=__nav_8_11> <span class="md-nav__icon md-icon"></span> 代理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/proxy/haproxy.md class=md-nav__link> haproxy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_12 type=checkbox id=__nav_8_12> <label class=md-nav__link for=__nav_8_12> 监控 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=监控 data-md-level=2> <label class=md-nav__title for=__nav_8_12> <span class="md-nav__icon md-icon"></span> 监控 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/monitor/grafana.md class=md-nav__link> grafana </a> </li> <li class=md-nav__item> <a href=../../roles/monitor/zabbix-agent.md class=md-nav__link> zabbix-agent </a> </li> <li class=md-nav__item> <a href=../../roles/monitor/zabbix-server.md class=md-nav__link> zabbix-server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_13 type=checkbox id=__nav_8_13> <label class=md-nav__link for=__nav_8_13> 日志分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日志分析 data-md-level=2> <label class=md-nav__title for=__nav_8_13> <span class="md-nav__icon md-icon"></span> 日志分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/log/elasticsearch.md class=md-nav__link> elasticsearch </a> </li> <li class=md-nav__item> <a href=../../roles/log/filebeat.md class=md-nav__link> filebeat </a> </li> <li class=md-nav__item> <a href=../../roles/log/grokdebug.md class=md-nav__link> grokdebug </a> </li> <li class=md-nav__item> <a href=../../roles/log/kibana.md class=md-nav__link> kibana </a> </li> <li class=md-nav__item> <a href=../../roles/log/logstash.md class=md-nav__link> logstash </a> </li> <li class=md-nav__item> <a href=../../roles/log/heartbeat.md class=md-nav__link> heartbeat </a> </li> <li class=md-nav__item> <a href=../../roles/log/metricbeat.md class=md-nav__link> metricbeat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_14 type=checkbox id=__nav_8_14> <label class=md-nav__link for=__nav_8_14> 存储 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=存储 data-md-level=2> <label class=md-nav__title for=__nav_8_14> <span class="md-nav__icon md-icon"></span> 存储 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/storage/gluster.md class=md-nav__link> gluster </a> </li> <li class=md-nav__item> <a href=../../roles/storage/nfs.md class=md-nav__link> nfs </a> </li> <li class=md-nav__item> <a href=../../roles/storage/samba.md class=md-nav__link> samba </a> </li> <li class=md-nav__item> <a href=../../roles/storage/vsftpd.md class=md-nav__link> vsftpd </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_15 type=checkbox id=__nav_8_15> <label class=md-nav__link for=__nav_8_15> 容器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=容器 data-md-level=2> <label class=md-nav__title for=__nav_8_15> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/container/docker-compose.md class=md-nav__link> docker-compose </a> </li> <li class=md-nav__item> <a href=../../roles/container/docker-swarm.md class=md-nav__link> docker-swarm </a> </li> <li class=md-nav__item> <a href=../../roles/container/docker.md class=md-nav__link> docker </a> </li> <li class=md-nav__item> <a href=../../roles/container/harbor.md class=md-nav__link> harbor </a> </li> <li class=md-nav__item> <a href=../../roles/container/kubernetes-bin.md class=md-nav__link> kubernetes-bin </a> </li> <li class=md-nav__item> <a href=../../roles/container/kubernetes.md class=md-nav__link> kubernetes </a> </li> <li class=md-nav__item> <a href=../../roles/container/shipyard.md class=md-nav__link> shipyard </a> </li> <li class=md-nav__item> <a href=../../roles/container/nomad.md class=md-nav__link> nomad </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_16 type=checkbox id=__nav_8_16> <label class=md-nav__link for=__nav_8_16> 数据同步 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据同步 data-md-level=2> <label class=md-nav__title for=__nav_8_16> <span class="md-nav__icon md-icon"></span> 数据同步 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/sync/rsync.md class=md-nav__link> rsync </a> </li> <li class=md-nav__item> <a href=../../roles/sync/sersync.md class=md-nav__link> sersync </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_17 type=checkbox id=__nav_8_17> <label class=md-nav__link for=__nav_8_17> 运维管理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=运维管理 data-md-level=2> <label class=md-nav__title for=__nav_8_17> <span class="md-nav__icon md-icon"></span> 运维管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ops/os-check.md class=md-nav__link> os-check </a> </li> <li class=md-nav__item> <a href=../../roles/ops/backup-file.md class=md-nav__link> backup-file </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_18 type=checkbox id=__nav_8_18> <label class=md-nav__link for=__nav_8_18> 其他 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其他 data-md-level=2> <label class=md-nav__title for=__nav_8_18> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/other/chrony.md class=md-nav__link> chrony </a> </li> <li class=md-nav__item> <a href=../../roles/other/confd.md class=md-nav__link> confd </a> </li> <li class=md-nav__item> <a href=../../roles/other/iptables.md class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=../../roles/other/ntp.md class=md-nav__link> ntp </a> </li> <li class=md-nav__item> <a href=../../roles/other/supervisor.md class=md-nav__link> supervisor </a> </li> <li class=md-nav__item> <a href=../../roles/other/vault.md class=md-nav__link> vault </a> </li> <li class=md-nav__item> <a href=../../roles/other/cfssl.md class=md-nav__link> cfssl </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/fengzhao/mysql-wiki/edit/master/docs/foundmental/suoyin.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=1>1、索引基本概念<a class=headerlink href=#1 title="Permanent link">&para;</a></h1> <p>数据库中的索引，就像是书籍中的目录一样。</p> <p>或者是我们去图书馆看书时，通常在图书馆网络上查找到想看的书的索书号，然后根据图书馆分类索引去查找对应的书架找到书籍。</p> <p>在数据库中的索引，也是这个概念。</p> <p>为了根据给定 ID 检索一条 <em>student</em> 记录，数据库系统会先查找索引，找到记录所在的磁盘块，然后读取所需的 <em>student</em> 记录。</p> <p>索引是一种典型的 <strong>空间换取时间</strong> 的算法思想，在磁盘中存储一些额外的索引文件，来提高查找效率。</p> <p>这里的查找，并不是简单的查询，无论是增删改查，都需要查找相应的位置进行插入，或者找到相应的记录再进行删除和修改。</p> <p><strong>所以索引提高的并不仅仅只是查询效率。</strong></p> <p>根据索引的作用：无论是增删改查，都是要先查找到相应的记录，<strong>而且在增删改时也要修改索引数据。索引也会带来一些额外的维护开销</strong>。</p> <p><strong>评价索引性能大概有如下几种因素</strong>：</p> <ul> <li><strong>访问类型</strong>：索引能够支持的访问类型，主要的访问类型包括：特定记录的查找（等值查找），范围查找 。</li> <li><strong>访问时间</strong>：在查询中，使用索引技术查找到记录的时间。</li> <li><strong>插入时间</strong>：插入新数据项的时间，包括找到正确的位置插入数据项和更新索引所需要的时间。</li> <li><strong>删除时间</strong>：删除数据项的时间，包括找到要被删除的项和更新索引所需要的时间。</li> <li><strong>空间开销</strong>：索引结构占用的额外的空间开销</li> </ul> <h1 id=_1>索引的基本数据结构<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <p>根据索引的数据结构分类，有两种基本的索引类型：</p> <p><strong>散列索引（哈希索引）</strong></p> <ul> <li> <p>散列索引主要的数据结构就是哈希表。只有精确匹配索引的所有列的查询才有效。</p> </li> <li> <p>对于每一行数据，存储引擎都会对所有的索引列计算一个哈希码，哈希码是一个较小的值，并且不同键值的行计算出来的哈希码也不一样（也可能有哈希冲突）。</p> </li> <li>哈希索引将所有的哈希码存储在索引中，同时在哈希表中保存指向每个数据行的指针。</li> <li> <p><strong>也就是说，由于哈希查找比起B-Tree索引，其本身对于单行查询的时间复杂度更低，有了哈希索引后明显可加快单行查询速度。</strong></p> </li> <li> <p><strong>哈希索引不是按照索引值顺序存储的，所以也就无法用于排序查找。</strong></p> </li> <li><strong>散列索引仅支持 仅能满足 "=","IN"和"&lt;=&gt;"查询，不能使用范围查询，例如 " where price &gt; 100"（注意 "&lt;=&gt;" 和 "&lt;" ,"&gt;" 是不同的运算符。）</strong></li> <li>其检索效率非常高，索引的检索可以一次定位，不像B-Tree 索引需要从根节点到枝节点，最后才能访问到页节点这样多次的IO访问。所以 Hash 索引的查询效率要远高于 B-Tree 索引。</li> <li>MySQL 的 InnoDB 存储引擎中有个功能叫 <strong>自适应哈希索引( adaptive hash index)</strong>，当 InnoDB 注意到某些索引值使用的非常频繁时，它会在内存中基于 B -Tree 索引之上再创建一个哈希索引，这样就让 B-Tree 也具有哈希索引的一些优点，比如快速查找，这是一个自动的、内部的行为，用户无法控制或配置，不过如果有必要，可以自己关掉。</li> </ul> <p><strong>顺序索引</strong></p> <p>顺序索引的主要数据结构是 B-Tree 。将索引列的数据</p> <p>索引项是由索引码值和指向具有该索引码的一条或多条记录的指针组成。</p> <h2 id=_2>稠密索引<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>索引是连续的，即在要索引列的每一行中，都有索引项。索引项包括</p> <p>稠密索引的特点是占用空间大，搜索效率高。</p> <h2 id=_3>稀疏索引<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>索引是非连续的。</p> <p>在稀疏索引中，只为搜索码的某些值建立索引项。只有当数据是按照</p> <p>考虑一本字典，每一页的页眉都顺序的列出了该页中按字母顺序出现的第一个单词，这个字典所有页的页眉构成了这个字典的稀疏索引。</p> <p>显然，稠密索引是可以快速定位一条记录的。</p> <p>但是稀疏索引的优点在于：</p> <ul> <li>占用更少的空间。</li> <li>插入和删除时的开销更小。</li> </ul> <p>系统设计者必须在存取时间和空间开销之间权衡。尽管有关这一权衡的决定依赖于具体的应用，但是为每个块建立稀疏索引是比较好的折中。<strong>设计索引的粒度很重要</strong></p> <p><strong>处理数据库查询的开销，主要是把块从磁盘读取到内存中的时间。一旦块被读入内存，扫描整个块的时间几乎是可以忽略的。</strong></p> <p>（磁盘被读取到内存是以块为单位，一个数据块中的可以存取多条记录）</p> <h2 id=_4>多级索引<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>假设要在 100 000 000 行数据上建立了稠密索引，1个 4KB 的数据块可以容纳 100 条索引项。这样索引文件就需要占用 1 000 000 个数据块。即 4GB。</p> <p>这个索引文件以顺序的方式存储在磁盘中。</p> <p>如果索引小到可以放到内存中。那么搜索一个索引项的时间非常小。（即使索引比内存小，也不可能全部读入内存，内存还需要处理其他任务）</p> <p>在索引文件中，用二分查找法来进行搜索。</p> <p>多级索引其实就是索引的索引。 </p> <h2 id=_5>索引的更新<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <p>无论采用什么形式的索引，每当有记录插入或者删除时，索引都需要更新。</p> <p>如果有记录更新，任何该记录上的搜索码受影响的索引也必须更新。</p> <p>例如，如果一个教师的系发生了变化，那么 instructor 上的 dept_name 列上的索引也必须相应的更新。</p> <p>索引的更新可以认为是删除旧的索引，随后插入对应的新记录。因此，只需要考虑索引的插入和删除。</p> <h1 id=_6>索引类型<a class=headerlink href=#_6 title="Permanent link">&para;</a></h1> <p>按照索引的数据结构，MySQL 中的**索引方法**可以分为</p> <ul> <li> <p>哈希索引（HASH）</p> </li> <li> <p>BTREE索引（BREE）</p> </li> </ul> <p>按照索引类型，可以分为：</p> <ul> <li>普通索引（NORMAL）</li> <li>唯一索引（UNIQUE）</li> <li>全文索引（FULLTEXT）（MySQL8.0）</li> <li>地理索引（SPATIAL）</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>-- 索引语法：ALTER TABLE table1 ADD (UNIQUE| SPATIAL | FULLTEXT )INDEX idx_name(column(length)) USING  BTREE |HASH ;</span>
<span class=c1>-- 索引语法：ALTER TABLE table1 ADD INDEX idx_name(column) USING  BTREE |HASH ;</span>

<span class=c1>-- 添加普通的B-tree索引</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>t1</span>   <span class=k>ADD</span> <span class=k>INDEX</span> <span class=n>idx_name</span><span class=p>(</span><span class=k>column</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span> <span class=k>USING</span> <span class=n>BTREE</span><span class=p>;</span>
<span class=c1>-- 添加unique的B-tree索引</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>t1</span>   <span class=k>ADD</span> <span class=k>INDEX</span> <span class=k>unique</span> <span class=n>idx_name</span><span class=p>(</span><span class=k>column</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span> <span class=k>USING</span> <span class=n>BTREE</span><span class=p>;</span>
</code></pre></div> <h2 id=_7>隐藏索引<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <p>MySQL 8.0.19 中新增了三种索引方式：隐藏索引、降序索引、函数索引</p> <p><strong>隐藏索引概述</strong></p> <p>MySQL 8.0.19 及以上支持隐藏索引（invisible index），也称为不可见索引。<strong>隐藏索引不会默认被优化器使用。主键不能设置为隐藏（包括显式设置或隐式设置）</strong></p> <p>实际上，通过这种方式创建的索引，索引文件还是存在的，只是默认不会被优化器使用。</p> <p><strong>这个功能在测试评估索引有效性时非常有用。DBA对希望删除的索引开启该功能，经过完整验证，确认之后，可以放心删除索引。</strong></p> <p>所有的索引默认是可见的，可以在 CREATE TABLE, CREATE INDEX, ALTER TABLE的时候，对新索引设置为不可见。使用方法如下：</p> <div class=highlight><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>t1</span> <span class=p>(</span>
  <span class=n>i</span> <span class=nb>INT</span><span class=p>,</span>
  <span class=n>j</span> <span class=nb>INT</span><span class=p>,</span>
  <span class=n>k</span> <span class=nb>INT</span><span class=p>,</span>
  <span class=k>INDEX</span> <span class=n>i_idx</span> <span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=n>INVISIBLE</span>  <span class=c1>-- 隐藏索引</span>
<span class=p>)</span> <span class=n>ENGINE</span> <span class=o>=</span> <span class=n>InnoDB</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>INDEX</span> <span class=n>j_idx</span> <span class=k>ON</span> <span class=n>t1</span> <span class=p>(</span><span class=n>j</span><span class=p>)</span> <span class=n>INVISIBLE</span><span class=p>;</span>  <span class=c1>-- 隐藏索引</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>t1</span> <span class=k>ADD</span> <span class=k>INDEX</span> <span class=n>k_idx</span> <span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=n>INVISIBLE</span><span class=p>;</span> <span class=c1>-- 隐藏索引</span>

<span class=c1>-- 隐藏索引与可见索引的转换</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>t1</span> <span class=k>ALTER</span> <span class=k>INDEX</span> <span class=n>i_idx</span> <span class=n>INVISIBLE</span><span class=p>;</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=n>t1</span> <span class=k>ALTER</span> <span class=k>INDEX</span> <span class=n>i_idx</span> <span class=n>VISIBLE</span><span class=p>;</span>

<span class=c1>-- 查看表中索引是否为隐藏索引 show index from t1;</span>

<span class=k>SELECT</span> <span class=n>INDEX_NAME</span><span class=p>,</span> <span class=n>IS_VISIBLE</span>
       <span class=k>FROM</span> <span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=k>STATISTICS</span>
       <span class=k>WHERE</span> <span class=n>TABLE_SCHEMA</span> <span class=o>=</span> <span class=s1>&#39;db1&#39;</span> <span class=k>AND</span> <span class=k>TABLE_NAME</span> <span class=o>=</span> <span class=s1>&#39;t1&#39;</span><span class=p>;</span>

<span class=o>+</span><span class=c1>------------+------------+</span>
<span class=o>|</span> <span class=n>INDEX_NAME</span> <span class=o>|</span> <span class=n>IS_VISIBLE</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>------------+------------+</span>
<span class=o>|</span> <span class=n>i_idx</span>      <span class=o>|</span> <span class=n>YES</span>        <span class=o>|</span>
<span class=o>|</span> <span class=n>j_idx</span>      <span class=o>|</span> <span class=k>NO</span>         <span class=o>|</span>
<span class=o>|</span> <span class=n>k_idx</span>      <span class=o>|</span> <span class=k>NO</span>         <span class=o>|</span>
<span class=o>+</span><span class=c1>------------+------------+</span>
</code></pre></div> <p>当将索引设置为不可见时，可以通过下面几个方法确认优化器是否需要使用到该索引：</p> <ul> <li> <p>使用到该索引的索引提示语句会发生错误。(index hint)</p> </li> <li> <p>查询的执行计划和之前的不同</p> </li> <li> <p>查询出现在慢日志中</p> </li> <li> <p>Performance Schema里面相关的查询工作量会增加</p> </li> </ul> <p><strong>隐藏索引的相关说明</strong></p> <ul> <li>除了主键，其他索引都可以设置为隐藏索引。</li> <li>对于唯一键：例外情况: 没有主键的情况下，第一个唯一键 不可隐藏，第二个唯一键可隐藏。</li> <li> <p><strong>MySQL在没有主键的情况下 是把第一个唯一建做为主键。</strong></p> </li> <li> <p>系统变量 optimizer_switch 的 use_invisible_indexes 值控制了优化器构建执行计划时是否使用隐藏索引。</p> </li> <li>如果设置为 off （默认值），优化器将会忽略隐藏索引（与引入该属性之前的行为相同）。</li> <li>如果设置为 on，隐藏索引仍然不可见，但是优化器在构建执行计划时将会考虑这些索引。</li> </ul> <p><strong>总结</strong></p> <p>不可见索引特性可以用于测试删除某个索引对于查询性能的影响，同时又不需要真正删除索引，也就避免了错误删除之后的索引重建。</p> <p>对于一个大表上的索引进行删除重建将会非常耗时，而将其设置为不可见或可见将会非常简单快捷。</p> <h2 id=_8>全文索引<a class=headerlink href=#_8 title="Permanent link">&para;</a></h2> <h2 id=_9>降序索引<a class=headerlink href=#_9 title="Permanent link">&para;</a></h2> <p>MySQL8.0开始真正支持降序索引，只有 InnoDB 引擎支持降序索引，且必须是 BTREE 降序索引，MySQL8.0不再对 group by 操作进行隐式排序。</p> <p>MySQL 支持降序索引：索引定义中的 DESC 不再被忽略，而是按降序存储键值。以前，可以以相反的顺序扫描索引，但是会导致性能损失。</p> <div class=highlight><pre><span></span><code><span class=c1>-- 同一个建表语句</span>
<span class=k>create</span> <span class=k>table</span> <span class=n>slowtech</span><span class=p>.</span><span class=n>t1</span><span class=p>(</span><span class=n>c1</span> <span class=nb>int</span><span class=p>,</span><span class=n>c2</span> <span class=nb>int</span><span class=p>,</span><span class=k>index</span> <span class=n>idx_c1_c2</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span><span class=n>c2</span> <span class=k>desc</span><span class=p>));</span>

<span class=c1>-- MySQL5.7  </span>
<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>show</span> <span class=k>create</span> <span class=k>table</span> <span class=n>slowtech</span><span class=p>.</span><span class=n>t1</span><span class=err>\</span><span class=k>G</span>
<span class=o>***************************</span> <span class=mi>1</span><span class=p>.</span> <span class=k>row</span> <span class=o>***************************</span>
      <span class=k>Table</span><span class=p>:</span> <span class=n>t1</span>
<span class=k>Create</span> <span class=k>Table</span><span class=p>:</span> <span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>t1</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>c1</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>c2</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>idx_c1_c2</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>c1</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>c2</span><span class=o>`</span><span class=p>)</span>  <span class=c1>-- 虽然c2列指定了desc，但在实际的建表语句中还是将其忽略了</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span> <span class=k>DEFAULT</span> <span class=n>CHARSET</span><span class=o>=</span><span class=n>latin1</span>
<span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>

<span class=c1>-- MySQL8.0</span>
<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>show</span> <span class=k>create</span> <span class=k>table</span> <span class=n>slowtech</span><span class=p>.</span><span class=n>t1</span><span class=err>\</span><span class=k>G</span>
<span class=o>***************************</span> <span class=mi>1</span><span class=p>.</span> <span class=k>row</span> <span class=o>***************************</span>
      <span class=k>Table</span><span class=p>:</span> <span class=n>t1</span>
<span class=k>Create</span> <span class=k>Table</span><span class=p>:</span> <span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>t1</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>c1</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>c2</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>idx_c1_c2</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>c1</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>c2</span><span class=o>`</span> <span class=k>DESC</span><span class=p>)</span> <span class=c1>--保留了desc子句</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span> <span class=k>DEFAULT</span> <span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8mb4</span> <span class=k>COLLATE</span><span class=o>=</span><span class=n>utf8mb4_0900_ai_ci</span>
<span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></div> <h3 id=_10>降序索引的意义<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>如果一个查询，需要对多个列进行排序，且顺序要求不一致。在这种场景下，要想避免数据库额外的排序- "filesort"，只能使用降序索引。</p> <p>比如，先按 c1 升序，然后按照 c2 降序</p> <p>还是上面这张表，来看看有降序索引和没降序索引区别。</p> <div class=highlight><pre><span></span><code><span class=c1>-- mysql5.7</span>
<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>explain</span> <span class=k>select</span> <span class=o>*</span> <span class=k>from</span> <span class=n>slowtech</span><span class=p>.</span><span class=n>t1</span> <span class=k>order</span> <span class=k>by</span> <span class=n>c1</span><span class=p>,</span><span class=n>c2</span> <span class=k>desc</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------------+</span>
<span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span> <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span>  <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>      <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>                      <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------------+</span>
<span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>t1</span>    <span class=o>|</span> <span class=k>NULL</span>      <span class=o>|</span> <span class=k>index</span> <span class=o>|</span> <span class=k>NULL</span>          <span class=o>|</span> <span class=n>idx_c1_c2</span> <span class=o>|</span> <span class=mi>10</span>      <span class=o>|</span> <span class=k>NULL</span> <span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>  <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>index</span><span class=p>;</span> <span class=k>Using</span> <span class=n>filesort</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+-------+------------+-------+---------------+-----------+---------+------+------+----------+-----------------------------+</span>
<span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></div> <h3 id=mysql-group-by>MySQL group by 隐式排序<a class=headerlink href=#mysql-group-by title="Permanent link">&para;</a></h3> <p><strong>从 5.7 升级到 8.0 的注意事项</strong></p> <p>在 MySQL5.7 中，group by 子句会隐式排序。</p> <p>默认情况下 GROUP BY 会隐式排序（即 group by id 后面没有 asc 和 desc 关键字）。但是 group by 自己会排序</p> <ul> <li> <p>不推荐 <strong>GROUP BY隐式排序（group by id）</strong> 或**GROUP BY显式排序( group by id desc)**。</p> </li> <li> <p>要生成给定的排序 ORDER，请提供ORDER BY子句。<code>group by id order by id</code></p> </li> </ul> <div class=highlight><pre><span></span><code> <span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>t</span> <span class=p>(</span><span class=n>id</span> <span class=nb>INTEGER</span><span class=p>,</span>  <span class=n>cnt</span> <span class=nb>INTEGER</span><span class=p>);</span>

<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>t</span> <span class=k>VALUES</span> <span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=mi>1</span><span class=p>),(</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>),(</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>),(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>),(</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>),(</span><span class=mi>1</span><span class=p>,</span><span class=mi>5</span><span class=p>),(</span><span class=mi>2</span><span class=p>,</span><span class=mi>6</span><span class=p>),(</span><span class=mi>2</span><span class=p>,</span><span class=mi>1</span><span class=p>),(</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>),(</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>),(</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>),(</span><span class=mi>3</span><span class=p>,</span><span class=mi>6</span><span class=p>);</span>

<span class=c1>-- 在MySQL5.7中，下面这三条sql看起来执行的效果是一样的</span>

<span class=c1>-- 推荐，5.7和8.0效果一致</span>
<span class=k>select</span> <span class=n>id</span><span class=p>,</span> <span class=k>SUM</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span> <span class=k>from</span> <span class=n>t</span> <span class=k>group</span> <span class=k>by</span> <span class=n>id</span> <span class=k>order</span> <span class=k>by</span> <span class=n>id</span><span class=p>;</span> 
<span class=c1>-- 不推荐  --8.0中不会排序</span>
<span class=k>select</span> <span class=n>id</span><span class=p>,</span> <span class=k>SUM</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span> <span class=k>from</span> <span class=n>t</span> <span class=k>group</span> <span class=k>by</span> <span class=n>id</span> <span class=p>;</span> 
<span class=c1>-- 不推荐  --8.0中直接报错</span>
<span class=k>select</span> <span class=n>id</span><span class=p>,</span> <span class=k>SUM</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span> <span class=k>from</span> <span class=n>t</span> <span class=k>group</span> <span class=k>by</span> <span class=n>id</span>  <span class=k>asc</span><span class=p>;</span> 

<span class=o>+</span><span class=c1>------+----------+</span>
<span class=o>|</span> <span class=n>id</span>   <span class=o>|</span> <span class=k>SUM</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>------+----------+</span>
<span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>       <span class=mi>13</span> <span class=o>|</span>
<span class=o>|</span>    <span class=mi>2</span> <span class=o>|</span>        <span class=mi>9</span> <span class=o>|</span>
<span class=o>|</span>    <span class=mi>3</span> <span class=o>|</span>       <span class=mi>12</span> <span class=o>|</span>
<span class=o>|</span>    <span class=mi>4</span> <span class=o>|</span>        <span class=mi>6</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>------+----------+</span>
<span class=mi>4</span> <span class=k>rows</span> <span class=k>in</span> <span class=k>set</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>

<span class=c1>-- 从 MySQL8.0 开始，不支持 GROUP BY隐式排序 和 GROUP BY显式排序</span>
</code></pre></div> <h1 id=_11>索引组织表<a class=headerlink href=#_11 title="Permanent link">&para;</a></h1> <p>目前的流行的 MySQL 存储引擎中，InnoDB 是最优先的引擎选型，我们在部署和规划的过程中，应该首选为 InnoDB 作为存储引擎的首选。</p> <p>在 InnoDB 存储引擎中，因为表都是按照主键的顺序进行存放的，我们称之为索引组织表(index organized table ，IOT)</p> <p>因为在 InnoDB 中，数据文件本身就是根据主键索引排序的B+Tree的数据结构，叶节点包含了完整的数据记录。</p> <blockquote> <p>clustered index</p> <p>The InnoDB term for a primary key index. InnoDB table storage is organized based on the values of the</p> <p>primary key columns, to speed up queries and sorts involving the primary key columns. For best performance,</p> <p>choose the primary key columns carefully based on the most performance-critical queries. Because modifying</p> <p>the columns of the clustered index is an expensive operation, choose primary columns that are rarely or never updated.</p> <p>In the Oracle Database product, this type of table is known as an index-organized table.</p> <p>See Also index, primary key, secondary index.</p> </blockquote> <h2 id=clustered-index>聚集索引(clustered index)<a class=headerlink href=#clustered-index title="Permanent link">&para;</a></h2> <p><strong>innodb 表中的主键，就是聚簇索引。</strong></p> <p>主键索引的叶子节点存的是整行数据。由于表里的数据行只能按照一颗B+树排序，因此**一张表只能有一个聚簇索引。**</p> <ul> <li> <p><strong>如果在建表时没有主键，会用一个不为空的唯一索引列做为主键，成为此表的聚簇索引。</strong></p> </li> <li> <p><strong>如果在建表时也没有索引，InnoDB会隐式定义使用UUID形式一个主键来作为聚簇索引。</strong></p> </li> </ul> <p><strong>一般建议在建表的时候显式指定主键（这样MySQL就自动根据这个主键索引去存储数据）。</strong></p> <p><strong>在InnoDB中，聚簇索引默认就是主键索引</strong>。</p> <p><strong>如果在建表后，并且表中已经有大量数据时，再为这个表创建主键索引或者修改主键索引的代价是很高的。这个操作其实就是重建表。</strong></p> <div class=highlight><pre><span></span><code><span class=c1>-- 重建表</span>
<span class=k>alter</span> <span class=k>table</span> <span class=n>T</span> <span class=n>engine</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span>
</code></pre></div> <p>对于联合主键和索引组织表的理解</p> <div class=highlight><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>geek</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>a</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>b</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=k>c</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>d</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=o>`</span><span class=n>a</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>b</span><span class=o>`</span><span class=p>),</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=k>c</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=k>c</span><span class=o>`</span><span class=p>),</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>ca</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=k>c</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>a</span><span class=o>`</span><span class=p>),</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>cb</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=k>c</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>b</span><span class=o>`</span><span class=p>)</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=p>;</span>


<span class=c1>-- 主键 a，b的聚簇索引组织顺序相当于 order by a,b ，也就是先按a排序，再按b排序，c无序。</span>
<span class=err>–</span><span class=n>a</span><span class=c1>--|–b--|–c--|–d--</span>
<span class=mi>1</span> <span class=mi>2</span> <span class=mi>3</span> <span class=n>d</span>
<span class=mi>1</span> <span class=mi>3</span> <span class=mi>2</span> <span class=n>d</span>
<span class=mi>1</span> <span class=mi>4</span> <span class=mi>3</span> <span class=n>d</span>
<span class=mi>2</span> <span class=mi>1</span> <span class=mi>3</span> <span class=n>d</span>
<span class=mi>2</span> <span class=mi>2</span> <span class=mi>2</span> <span class=n>d</span>
<span class=mi>2</span> <span class=mi>3</span> <span class=mi>4</span> <span class=n>d</span>
</code></pre></div> <h2 id=secondary-index><strong>非聚集索引(secondary index)</strong><a class=headerlink href=#secondary-index title="Permanent link">&para;</a></h2> <p>非主键索引，其实是另外一颗单独的 B+Tree，叶子结点中只存放主键索引的值。</p> <p>通过非主键索引查找数据时，先去查找索引所在的B+树上进行查找。然后再根据索引的值，再去主键索引的B+树上进行查找。</p> <p>第二个过程被称为**回表查询，**即要查询的列不在非主键索引中。</p> <div class=highlight><pre><span></span><code><span class=c1>-- 查看表中的索引详情</span>
<span class=k>SHOW</span> <span class=k>INDEX</span> <span class=k>FROM</span> <span class=k>table_name</span><span class=p>;</span>
<span class=c1>-- 创建唯一索引</span>
<span class=k>ALTER</span> <span class=k>TABLE</span> <span class=k>table_name</span> <span class=k>ADD</span> <span class=k>UNIQUE</span> <span class=p>(</span><span class=k>column</span><span class=p>);</span>
</code></pre></div> <h3 id=multi-range-readmrr>Multi-Range Read（MRR）<a class=headerlink href=#multi-range-readmrr title="Permanent link">&para;</a></h3> <hr> <p>在 secondary index 上进行范围查询或等值查询时，返回的主键索引值可能是无序的。后续的回表查询就变成了随机读。</p> <p>MRR 要把主键排序，这样之后对磁盘的操作就是由顺序读代替之前的随机读。</p> <p>从资源的使用情况上来看就是让 CPU 和内存多做点事，来换磁盘的顺序读。然而排序是需要内存的，这块内存的大小就由参数 read_rnd_buffer_size 来控制。</p> <p>MRR在通过二级索引获取到主键ID后，将ID值放入read_rnd_buffer中，然后对其进行排序，利用排序后的ID数组遍历主键索引查找记录并返回结果集，优化了回表性能。</p> <p>read_rnd_buffer_size 这是一个内存中的buffer用于分配给每个客户端用的。默认值是0.25MB，最大值为 2GB</p> <p>所以不能设置 global 全局变量太大，所以只能客户端自己运行大查询时进行设置。</p> <h2 id=_12><strong>索引覆盖</strong><a class=headerlink href=#_12 title="Permanent link">&para;</a></h2> <p>索引覆盖（index covering），故名思义，要查询的数据列都在索引树上查询完成了，不需要再回主键的这颗二叉树上进行**回表查询**。</p> <blockquote> <p>An index that provides all the necessary results for a query is called a covering index.</p> </blockquote> <p><strong>由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。</strong></p> <p>**通常使用联合索引来提升查询性能。**比如有一个市民信息表，身份证号是市民的唯一标识：</p> <div class=highlight><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>tuser</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>id</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>id_card</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>name</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>age</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>ismale</span><span class=o>`</span> <span class=n>tinyint</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>id_card</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>id_card</span><span class=o>`</span><span class=p>),</span>
  <span class=k>KEY</span> <span class=o>`</span><span class=n>name_age</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>age</span><span class=o>`</span><span class=p>)</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=k>In</span>
</code></pre></div> <p>如果要根据市民身份证号查询市民信息的需求，在身份证号字段上建立索引就够了。</p> <p>现在如果有一个高频请求，要根据市民的身份证号查询他的姓名，就可以建立</p> <h3 id=_13>联合索引<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <hr> <p>MySQL可以创建联合索引（即在多列上创建索引，一个索引可以包含最多16列。）</p> <p>联合索引的好处：</p> <h2 id=-col1col2col3-col1col1col2col1col2col3>- 建一个联合索引 <code>(col1,col2,col3)</code>，实际相当于建了 <code>(col1)</code>，<code>(col1,col2)</code>，<code>(col1,col2,col3)</code> 三个索引。每多一个索引，都会增加写操作的开销和磁盘空间的开销。对于大量数据的表，使用联合索引会大大的减少开销！<a class=headerlink href=#-col1col2col3-col1col1col2col1col2col3 title="Permanent link">&para;</a></h2> <h4 id=_14>最左前缀匹配原则<a class=headerlink href=#_14 title="Permanent link">&para;</a></h4> <p>关于最左前缀匹配，有如下原则：</p> <p>顺序扫描索引</p> <div class=highlight><pre><span></span><code><span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>test</span> <span class=p>(</span>
    <span class=n>id</span> <span class=nb>INT</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=n>last_name</span> <span class=nb>CHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=n>first_name</span> <span class=nb>CHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span><span class=p>,</span>
    <span class=n>age</span> <span class=nb>INT</span> <span class=k>NULL</span> <span class=p>,</span>    
    <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=n>id</span><span class=p>),</span>
    <span class=k>INDEX</span> <span class=n>name</span> <span class=p>(</span><span class=n>last_name</span><span class=p>,</span><span class=n>first_name</span><span class=p>,</span><span class=n>age</span><span class=p>)</span>
<span class=p>);</span>

<span class=c1>-- name 是一个包含了 last_name 和 first_name 列的联合索引。</span>

<span class=c1>-- 对于这个表，使用 (last_name) 和 (last_name,first_name) (last_name,first_name,age) 这样的条件才可以走索引</span>

<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;Jones&#39;</span><span class=p>;</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;Jones&#39;</span> <span class=k>AND</span> <span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;John&#39;</span><span class=p>;</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;Jones&#39;</span> <span class=k>AND</span> <span class=p>(</span><span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;John&#39;</span> <span class=k>OR</span> <span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;Jon&#39;</span><span class=p>);</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;Jones&#39;</span> <span class=k>AND</span> <span class=n>first_name</span> <span class=o>&gt;=</span><span class=s1>&#39;M&#39;</span> <span class=k>AND</span> <span class=n>first_name</span> <span class=o>&lt;</span> <span class=s1>&#39;N&#39;</span><span class=p>;</span>
<span class=k>select</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>where</span> <span class=n>last_name</span> <span class=k>like</span> <span class=s1>&#39;张%&#39;</span> <span class=k>and</span> <span class=n>age</span><span class=o>=</span><span class=mi>10</span> <span class=p>;</span>

<span class=c1>-- 下面的查询无法用到这个索引</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;John&#39;</span><span class=p>;</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>WHERE</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;Jones&#39;</span> <span class=k>OR</span> <span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;John&#39;</span><span class=p>;</span>
</code></pre></div> <h2 id=_15>前缀索引<a class=headerlink href=#_15 title="Permanent link">&para;</a></h2> <p>我们在给一个字段加索引的时候，实际上仅可以针对字段的前 n 位加索引。使用 <code>col_name(N)</code> 这样的格式。</p> <p><strong>在 varchar , blob , text 等类型的字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。</strong></p> <p><strong>索引长度和区分度其实是相互矛盾的。</strong></p> <p>索引长度过短，那么区分度就很低，查找时扫描的行越多，</p> <p>把索引长度加长，区分度就高，但是索引占用空间大，因此要掌握一个平衡点。</p> <p>索引其实都是排好序的数据结构，若是区分度高排序越快，区分度越低，排序慢；</p> <p>举个例子： （张，张三，张三哥），如果索引长度取1的话，那么每一行的索引都是 张 这个字，完全没有区分度，你让它怎么排序？</p> <p>结果这样三行完全是随机排的，因为索引都一样；</p> <p>如果长度取2，那么排序的时候至少前两个是排对了的，如果取3，区分度达到100%，排序完全正确；</p> <p>等等，那你说是不是索引越长越好？ 答案肯定是错的。</p> <p>比如 (张,李,王) 和 （张三啦啦啦，张三呵呵呵，张三呼呼呼）；</p> <p>前者在内存中排序占得空间少，排序也快，后者明显更慢更占内存，在大数据应用中这一点点都是很恐怖的；</p> <h3 id=_16>前缀索引优化原则<a class=headerlink href=#_16 title="Permanent link">&para;</a></h3> <hr> <p>索引长度的判断公式：</p> <p>test是要加索引的字段，5是索引长度，</p> <div class=highlight><pre><span></span><code><span class=c1>-- 查询表中某个字段最长的记录</span>
<span class=k>select</span>  <span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>,</span> <span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>)</span>  <span class=k>from</span> <span class=err>表名</span>  <span class=k>where</span>  <span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span> <span class=k>select</span> <span class=k>max</span><span class=p>(</span><span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>))</span> <span class=k>from</span> <span class=err>表名</span>  <span class=p>)</span>
<span class=c1>-- 查询表中某个字段最短的记录</span>
<span class=k>select</span>  <span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>,</span> <span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>)</span>  <span class=k>from</span> <span class=err>表名</span>  <span class=k>where</span>  <span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span> <span class=k>select</span> <span class=k>min</span><span class=p>(</span><span class=k>length</span><span class=p>(</span><span class=o>`</span><span class=err>字段</span><span class=o>`</span><span class=p>))</span> <span class=k>from</span> <span class=err>表名</span>  <span class=p>)</span>

<span class=c1>-- left函数取test字段的前5位，对前5位去重，这个</span>
<span class=k>select</span> <span class=k>count</span><span class=p>(</span><span class=k>distinct</span> <span class=k>left</span><span class=p>(</span><span class=n>test</span><span class=p>,</span><span class=mi>5</span><span class=p>))</span><span class=o>/</span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=k>from</span> <span class=k>table</span><span class=p>;</span>  

<span class=c1>-- 随着索引字段长度的扩大，这个区分度的值是越来越趋近于1，等于1即表示</span>


<span class=c1>-- 给字段指定前10位加索引</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>test</span> <span class=p>(</span><span class=n>blob_col</span> <span class=nb>BLOB</span><span class=p>,</span> <span class=k>INDEX</span><span class=p>(</span><span class=n>blob_col</span><span class=p>(</span><span class=mi>10</span><span class=p>)));</span>
</code></pre></div> <h2 id=_17>索引基数<a class=headerlink href=#_17 title="Permanent link">&para;</a></h2> <p>了解前缀索引之后，了解一下索引基数</p> <p><strong>索引基数</strong>（cardinality）：索引中不重复的索引值的数量；</p> <p>例如，例如，某个数据列包含值1、3、7、4、7、3， 那么它的**索引基数**就是4。</p> <p><strong>索引基数相对于数据表行数较高（也就是说，列中包含很多不同的值，重复的值很少，值很分散）的时候，它的工作效果最好。</strong></p> <ul> <li> <p>如果某数据列含有很多不同的年龄，索引会很快地分辨数据行。</p> </li> <li> <p>如果某个数据列用于记录性别（只有”M”和”F”两种值），那么索引的用处就不大。</p> </li> <li> <p>如果值出现的几率几乎相等，那么无论搜索哪个值都可能得到一半的数据行。</p> </li> </ul> <p>在这些情况下，最好根本不要使用索引，因为查询优化器发现某个值出现在表的数据行中的百分比很高的时候。</p> <p>它一般会忽略索引，进行全表扫描。惯用的百分比界线是”30%”。</p> <p>使用 show index from table 语句，</p> <h2 id=_18><strong>索引维护的代价</strong><a class=headerlink href=#_18 title="Permanent link">&para;</a></h2> <p>索引维护，B+树为了维护索引有序性，在插入新值的时候需要做必要的维护。</p> <p>如果你的主键的值是不连续的，那么在插入索引的时候，就要有移动B+树上节点的操作。</p> <p>如果插入值时父节点所在的数据页已经满了，根据B+树的算法，这时候需要申请一个新的数据页，然后挪动部分数据过去。</p> <p><strong>这个过程称为页分裂。在这种情况下，性能自然会受影响。</strong></p> <p>除了性能外，页分裂操作还影响数据页的利用率。原本放在一个页的数据，现在分到两个页中，整体空间利用率降低大约50%。</p> <p><strong>当然有分裂就有合并。当相邻两个页由于删除了数据，利用率很低之后，会将数据页做合并。合并的过程，可以认为是分裂过程的逆过程。</strong></p> <h3 id=_19>自增主键<a class=headerlink href=#_19 title="Permanent link">&para;</a></h3> <hr> <p>自增主键是指自增列上定义的主键，在建表语句中一般是这么定义的：</p> <div class=highlight><pre><span></span><code><span class=o>`</span><span class=n>rid</span><span class=o>`</span> <span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span>  <span class=k>NOT</span> <span class=k>NULL</span>  <span class=n>AUTO_INCREMENT</span><span class=p>,</span>
<span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span>
</code></pre></div> <p>插入新记录的时候可以不指定 ID 的值，系统会获取当前 ID 最大值加 1 作为下一条记录的 ID 值。</p> <p>也就是说，自增主键的插入数据模式，正符合了我们前面提到的递增插入的场景。</p> <p>每次插入一条新记录，都是追加操作，都不涉及到挪动其他记录，也不会触发叶子节点的分裂。</p> <p>而用业务逻辑的字段做主键，则往往不容易保证有序插入，这样写数据成本相对较高。</p> <p>除了性能外，还可以从存储空间来看，假设表中确实有一个唯一字段。</p> <p>比如字符串类型的身份证号，那应该用身份证号做主键，还是用自增字段做主键呢？</p> <p><strong>为什么不建议过长的字段做主键？</strong></p> <p>由于每个非主键索引的叶子节点上都是主键的值。如果用身份证号做主键，</p> <p>那么每个二级索引的叶子节点占用约20个字节，而如果用整型做主键，则只要4个字节，如果是长整型（bigint）则是8个字节。</p> <p><strong>显然，主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。</strong></p> <p><strong>所以从性能和存储来看，自增主键往往是更合适的选择。</strong></p> <h2 id=icp>索引下推（ICP）<a class=headerlink href=#icp title="Permanent link">&para;</a></h2> <p>在联合索引的最左前缀匹配时，以 INDEX name (last_name,first_name,age) 这个索引为例。有如下查询</p> <div class=highlight><pre><span></span><code><span class=k>select</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>test</span> <span class=k>where</span> <span class=n>last_name</span> <span class=k>like</span> <span class=s1>&#39;张%&#39;</span> <span class=k>and</span> <span class=n>age</span><span class=o>=</span><span class=mi>10</span> <span class=p>;</span>
</code></pre></div> <p>在 5.6 之前，这个语句在搜索索引树的时候，使用第一个字段的条件去匹配。找到所有匹配的行，逐行去主键索引上找到数据行，对比后面的条件。</p> <p>在 5.6 之后，MySQL 引入了**索引下推**优化，可以在索引遍历的过程中，对索引包含的字段先做判断，过滤掉不满足要求的行，减少回表次数。</p> <h1 id=optimizer-hints>优化器提示（Optimizer Hints）<a class=headerlink href=#optimizer-hints title="Permanent link">&para;</a></h1> <h1 id=index-hint>索引提示(index hint)<a class=headerlink href=#index-hint title="Permanent link">&para;</a></h1> <p>MySQL 可以使用索引提示（Index Hints）， 用于告诉**查询优化器**在查询中如何选择索引。</p> <p>索引提示只能用于 select 和 update 语句中。MySQL 共有三种索引提示，分别是：USE INDEX、IGNORE INDEX和FORCE INDEX。</p> <ul> <li> <p>use index(index_list) 告诉MySQL用索引列表中的其中一个索引去做本次查询</p> </li> <li> <p><code>sql -- 强制使用这两个索引去进行查找 SELECT * FROM table1 USE INDEX (col1_index,col2_index) WHERE col1=1 AND col2=2 AND col3=3;</code></p> </li> <li> <p>ignore index：ignore index告诉mysql不要使用某些索引去做本次查询</p> </li> <li> <p><code>sql SELECT * FROM table1 IGNORE INDEX (col3_index) WHERE col1=1 AND col2=2 AND col3=3;</code></p> </li> <li> <p>force index：force index和use index功能类似，都是告诉mySQL去使用某些索引。</p> </li> <li> <p>force index 和 use index 的区别是，如果使用force index，那么全表扫描就会被假定为需要很高代价，除非不能使用索引，否则不会考虑全表扫描；</p> </li> <li> <p>而使用 use index 的话，如果MySQL觉得全表扫描代价更低的话，仍然会使用全表扫描。</p> </li> <li> <p><code>sql SELECT * FROM table1 FORCE INDEX (col3_index) WHERE col1=1 AND col2=2 AND col3=3;</code></p> </li> </ul> <h3 id=_20>索引提示的用途<a class=headerlink href=#_20 title="Permanent link">&para;</a></h3> <p>可以在索引提示的后边使用FOR语句指定提示的范围，索引提示共有三种适用范围，分别是FOR JOIN、FOR ORDER BY、FOR GROUP BY：</p> <h1 id=mysql>MySQL优化器开关<a class=headerlink href=#mysql title="Permanent link">&para;</a></h1> <div class=highlight><pre><span></span><code><span class=k>SELECT</span> <span class=o>@@</span><span class=n>optimizer_switch</span><span class=p>;</span>

<span class=n>index_merge</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>index_merge_union</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>index_merge_sort_union</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>index_merge_intersection</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>engine_condition_pushdown</span><span class=o>=</span><span class=k>on</span>
<span class=n>index_condition_pushdown</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>mrr</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>mrr_cost_based</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>block_nested_loop</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>batched_key_access</span><span class=o>=</span><span class=k>off</span><span class=p>,</span>
<span class=n>materialization</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>semijoin</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>loosescan</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>firstmatch</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>duplicateweedout</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>subquery_materialization_cost_based</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>use_index_extensions</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>condition_fanout_filter</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>derived_merge</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>use_invisible_indexes</span><span class=o>=</span><span class=k>off</span><span class=p>,</span>
<span class=n>skip_scan</span><span class=o>=</span><span class=k>on</span><span class=p>,</span>
<span class=n>hash_join</span><span class=o>=</span><span class=k>on</span>


<span class=c1>-- 修改优化器</span>
<span class=k>SET</span> <span class=p>[</span><span class=k>GLOBAL</span><span class=o>|</span><span class=k>SESSION</span><span class=p>]</span> <span class=n>optimizer_switch</span><span class=o>=</span><span class=s1>&#39;command[,command]...&#39;</span><span class=p>;</span>

<span class=c1>-- command语法如下：</span>
<span class=c1>-- default          --重置为默认</span>
<span class=c1>-- opt_name=default --选项默认 </span>
<span class=c1>-- opt_name=off     --关掉某项优化</span>
<span class=c1>-- opt_name=on      --开启某项优化</span>
</code></pre></div> <h1 id=_21>尽量避免全表扫描<a class=headerlink href=#_21 title="Permanent link">&para;</a></h1> <p><a href=https://cloud.tencent.com/developer/article/1404687>https://cloud.tencent.com/developer/article/1404687</a></p> <p><a href=http://zhongmingmao.me/2019/03/08/mysql-full-table-scan/ >http://zhongmingmao.me/2019/03/08/mysql-full-table-scan/</a></p> <p>在 expain 查看一个 SQL 的执行计划时，如果 type 字段是 ALL ，则会进行全表扫描。</p> <p>SQL 优化的一条最基本的原则就是，当真正出现性能问题时或者影响到业务时，才考虑优化。</p> <p>全表扫描的情况：</p> <ul> <li>表足够小，数据量足够少，全表扫描的速度甚至比索引查找还要快。通常是 10 行之内的表。</li> <li>on 连接的字段，或者 where 条件的字段没有索引列，或者根本不带 where 条件。</li> <li></li> </ul> <h1 id=mysql_1>MySQL优化准则<a class=headerlink href=#mysql_1 title="Permanent link">&para;</a></h1> <p><a href=https://github.com/kekobin/blog/issues/87>https://github.com/kekobin/blog/issues/87</a></p> <p><a href=https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/MySQL%E9%AB%98%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BB%BA%E8%AE%AE.md>https://github.com/Snailclimb/JavaGuide/blob/master/docs/database/MySQL%E9%AB%98%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%A7%84%E8%8C%83%E5%BB%BA%E8%AE%AE.md</a></p> <h1 id=_22>性能优化概述<a class=headerlink href=#_22 title="Permanent link">&para;</a></h1> <p>数据库性能优化在数据库层面有很多因素，例如，表，查询语句，数据库配置等。</p> <p>数据库操作最终是作用在硬件层面的CPU和磁盘的IO操作上。所以要尽可能让开销足够小。</p> <h2 id=_23>数据库层面的优化<a class=headerlink href=#_23 title="Permanent link">&para;</a></h2> <ul> <li>表结构设计是否合理？是否满足三范式？范式和反范式的设计？<a href=https://www.zhihu.com/question/19900437>https://www.zhihu.com/question/19900437</a></li> <li>字段的数据类型是否合适？</li> <li>经常更新的应用应该设计为多个表，很少列。数据分析的应该设计为大宽表。</li> <li> <p>索引设计是否合理？</p> </li> <li> <p>是否选用合适的存储引擎？</p> </li> <li> <p>表是否有正确的row格式？</p> </li> </ul> <h2 id=_24>顺序索引<a class=headerlink href=#_24 title="Permanent link">&para;</a></h2> <p>为了快速随机访问文件中的记录，可以使用索引结构，每个索引结构与一个特定的搜索码关联。</p> <p>被索引的文件</p> <hr> <div class=md-source-date> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2021-11-11 02:55:05</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../basic/9.mysql_architecture/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 9. MySQL逻辑架构和性能优化概述" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 9. MySQL逻辑架构和性能优化概述 </div> </div> </a> <a href=../../advanced/1.0.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0innoDB%E6%9E%B6%E6%9E%84/ class="md-footer__link md-footer__link--next" aria-label="下一页: 1.0.MySQL架构到innoDB架构" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 1.0.MySQL架构到innoDB架构 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 - 2021 fengzhao </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>